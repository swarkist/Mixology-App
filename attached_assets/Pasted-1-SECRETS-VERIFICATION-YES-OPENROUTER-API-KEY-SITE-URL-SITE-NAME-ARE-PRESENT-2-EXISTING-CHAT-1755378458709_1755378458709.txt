1) SECRETS VERIFICATION
YES — OPENROUTER_API_KEY, SITE_URL, SITE_NAME ARE PRESENT.

2) EXISTING CHAT UI
BUILD ON THE EXISTING SCAFFOLD.
LOCATION: client/src/components/MixiChat.tsx.
IF THIS FILE DOES NOT EXIST, CREATE IT USING THE STREAMING IMPLEMENTATION DESCRIBED IN THE PROMPT (SSE PARSING OF data: { choices[0].delta.content }).
RENDER THE CHAT ONCE GLOBALLY (E.G., IN THE ROOT LAYOUT OR TOP NAV) SO IT’S AVAILABLE ON ALL PAGES.
EXPOSE AN OPEN FUNCTION SO CTAS CAN LAUNCH IT:

EITHER EXPORT A SMALL STORE/ATOM (useMixiChatStore) WITH open() / close()

OR LISTEN FOR A CUSTOM EVENT: window.dispatchEvent(new CustomEvent("mixi:open", { detail: { seed, context } }))

3) CHAT UI BEHAVIOR
OPEN AS A MODAL/OVERLAY ON TOP OF THE CURRENT PAGE.
DO NOT NAVIGATE AWAY; DO NOT USE SIDEBAR MODE.

4) MY BAR CONTEXT
PASS ALL ITEMS CURRENTLY IN THE USER’S BAR AS CONTEXT.
FORMAT:

{
  "myBar": [
    { "id": "<ingredientId>", "name": "<ingredientName>" }
  ]
}


INCLUDE THIS IN THE BODY TO /api/mixi/chat ALONG WITH ANY SEED MESSAGE.

5) TAG SEARCH SCOPE
ALWAYS PREFER OUR DATABASE RESULTS, BUT ALSO SUPPLEMENT WITH EXTERNAL COCKTAIL KNOWLEDGE WHEN HELPFUL.
IF BOTH ARE USED, CLEARLY INDICATE WHICH RESULTS COME FROM OUR DB VS. GENERAL KNOWLEDGE.
NEVER WRITE/MUTATE DATA.

6) ERROR HANDLING (OPENROUTER/ALL MODELS FAIL)
SHOW A GRACEFUL MESSAGE:
“I’M SORRY. LOOKS LIKE MY MIND IS NOT WORKING AT THE MOMENT. PLEASE TRY AGAIN LATER.”
NO QUEUING. NO ALTERNATE RESPONSE SYSTEM.

7) ICON & BRANDING
USE client/src/components/icons/MixiIconBartender.tsx FOR THE BUTTONS AND CHAT HEADER AVATAR (22–28PX IN A CIRCULAR GOLD BORDER).
USE GOLD BUTTONS: bg-yellow-500 text-black hover:bg-yellow-400.
LINK-STYLE CTAS: GOLD TEXT + UNDERLINE ON HOVER.

8) CTA PLACEMENT & SEEDS (ALL SHOULD CALL THE GLOBAL OPEN WITH OPTIONAL seed + context)

HOME: REPLACE SEARCH CTA WITH “ASK MIXI”. PLACEHOLDER → “MIXI IS HERE TO HELP YOU”.

COCKTAILS LIST: LINK ABOVE FILTER PILLS → SEED “TELL ME YOUR SPIRITS OR MOOD AND I’LL SUGGEST COCKTAILS.”

COCKTAIL DETAIL: BUTTON “ASK MIXI ABOUT THIS RECIPE”; CONTEXT { "cocktailId": "<id>" }; SEED “SCALE THIS TO A 64 OZ PITCHER (ROUND TO 0.25 OZ).”

INGREDIENTS: TOP-RIGHT BUTTON; WHEN AN ITEM IS FOCUSED, CONTEXT { "ingredientId": "<id>" }; SEED “WHAT CAN I SUBSTITUTE FOR THIS INGREDIENT AND WHAT’S A GOOD RATIO?”

PREFERRED BRANDS: NEAR SEARCH; SEED INCLUDES BRAND NAME.

MY BAR: ABOVE FILTERS; PASS FULL myBar LIST; SEED “WHAT CAN I MAKE WITH WHAT I HAVE? SHOW 3–5 OPTIONS.”

9) SYSTEM PROMPT MUST INCLUDE

PITCHER SCALING TO TARGET VOLUME, ROUND EACH INGREDIENT TO 0.25 OZ, NEVER EXCEED TARGET, HANDLE OZ/ML/TBSP/TSP/BARSPOON/DASH/PARTS.

CITRUS YIELDS: LIME ≈ 1 OZ, LEMON ≈ 2–3 TBSP (~1–1.5 OZ); PROVIDE MIN/MAX FRUIT COUNTS.

SIMPLE SYRUP (RICH) = 2 PARTS SUGAR : 1 PART WATER + SHORT METHOD.

TAGS: HOLIDAY, DESSERT, TIKI, ETC.

READ-ONLY; PREFER APP DB FOR NAMED ITEMS; ASK CLARIFYING QUESTIONS WHEN UNSURE.

10) MODEL ORDER (FALLBACKS)
deepseek/deepseek-v3:free → deepseek/deepseek-r1:free → meta-llama/llama-3.2-11b-vision-instruct:free → qwen/qwen2.5-coder:free.
STREAM RESPONSES; USE OPENROUTER HEADERS (AUTHORIZATION, HTTP-REFERER = SITE_URL, X-TITLE = SITE_NAME).

11) TEST-ON-FIX RULE
IF YOU ENCOUNTER AN ERROR AND APPLY A FIX, IMMEDIATELY TEST THE FIX.
IF THE SAME ERROR HAPPENS AGAIN, STOP AND ASK, INCLUDE LOGS AND WHAT YOU TRIED.
IF THE FIX FAILS, STOP AND SUMMARIZE ROOT CAUSE + FAILING STEP.

12) VALIDATION TO RUN & REPORT AT THE END

SECRETS PRESENT.

/api/mixi/chat CURL SMOKE TEST WITH STREAMING FRAMES.

64 OZ MARGARITA SCALING: ALL LINES ROUNDED TO 0.25 OZ; TOTAL ≤ 64 OZ; LIME/LEMON COUNTS; 2:1 SYRUP ON REQUEST.

TAG SEARCH: “SHOW 3 TIKI COCKTAILS” — DB RESULTS WITH OPTIONAL EXTERNAL SUPPLEMENT; CLEARLY LABELED; READ-ONLY.

CTAS: EACH PAGE OPENS CHAT AND PASSES CORRECT CONTEXT/SEED.

SECURITY: NO WRITES (NO POST/PUT/PATCH/DELETE) FROM MIXI.

A11Y: TABBABLE, ARIA-LABELS, FOCUS RETURNS TO ORIGIN CTA; VISIBLE FOCUS RINGS.